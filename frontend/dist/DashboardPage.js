import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from "react/jsx-runtime";
import { useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { BarChart3, Package, AlertTriangle, TrendingUp } from 'lucide-react';
import { useQuery } from '@tanstack/react-query';
import { productService } from './services/productService';
import { useAuth } from './hooks/useAuth';
import { useSyncOffline } from './hooks/useSyncOffline';
import { Card } from './components/ui/card';
const DashboardPage = () => {
    const navigate = useNavigate();
    const { user } = useAuth();
    const { isOnline, syncChanges } = useSyncOffline();
    // 오프라인 상태에서 온라인으로 전환 시 자동 동기화
    useEffect(() => {
        if (isOnline) {
            syncChanges();
        }
    }, [isOnline, syncChanges]);
    // 제품 데이터 조회
    const { data: products = [], isLoading, error } = useQuery({
        queryKey: ['products', { lowStock: false }],
        queryFn: () => productService.getProducts(),
    });
    // 저재고 제품 조회
    const { data: lowStockProducts = [] } = useQuery({
        queryKey: ['products', { lowStock: true }],
        queryFn: () => productService.getProducts({ lowStock: true }),
    });
    // 통계 계산
    const totalProducts = products.length;
    const totalStock = products.reduce((sum, product) => sum + product.quantity, 0);
    const totalLowStock = lowStockProducts.length;
    const totalCategories = [...new Set(products.map(p => p.category))].length;
    // 최근 입고/출고 제품 (실제로는 API에서 가져와야 함)
    const recentProducts = products.slice(0, 5);
    // 통계 계산
    const totalQuantity = products.reduce((sum, product) => sum + (product.quantity || 0), 0);
    const avgPrice = products.length > 0
        ? products.reduce((sum, product) => sum + (product.price || 0), 0) / products.length
        : 0;
    return (_jsx(_Fragment, { children: _jsxs("div", { className: "container mx-auto px-4", children: [_jsxs("div", { className: "flex flex-col md:flex-row md:items-center md:justify-between mb-6", children: [_jsx("h1", { className: "text-2xl font-bold text-gray-900 mb-4 md:mb-0", children: "\uB300\uC2DC\uBCF4\uB4DC" }), _jsx("div", { className: "flex space-x-2", children: _jsx("button", { onClick: () => navigate('/barcode'), className: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-kyobo hover:bg-kyobo-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-kyobo", children: "\uBC14\uCF54\uB4DC \uC2A4\uCE94" }) })] }), !isOnline && (_jsx("div", { className: "bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6", children: _jsxs("div", { className: "flex", children: [_jsx("div", { className: "flex-shrink-0", children: _jsx(AlertTriangle, { className: "h-5 w-5 text-yellow-400" }) }), _jsx("div", { className: "ml-3", children: _jsx("p", { className: "text-sm text-yellow-700", children: "\uD604\uC7AC \uC624\uD504\uB77C\uC778 \uC0C1\uD0DC\uC785\uB2C8\uB2E4. \uC77C\uBD80 \uAE30\uB2A5\uC774 \uC81C\uD55C\uB420 \uC218 \uC788\uC73C\uBA70, \uBCC0\uACBD\uC0AC\uD56D\uC740 \uC628\uB77C\uC778 \uC5F0\uACB0 \uC2DC \uC790\uB3D9\uC73C\uB85C \uB3D9\uAE30\uD654\uB429\uB2C8\uB2E4." }) })] }) })), _jsxs("div", { className: "grid gap-4 md:grid-cols-2 lg:grid-cols-4 mb-8", children: [_jsx(Card, { className: "p-6", children: _jsxs("div", { className: "flex items-center space-x-4", children: [_jsx("div", { className: "p-3 bg-blue-100 rounded-lg dark:bg-blue-900", children: _jsx(Package, { className: "w-6 h-6 text-blue-600 dark:text-blue-300" }) }), _jsxs("div", { children: [_jsx("p", { className: "text-sm font-medium text-gray-600 dark:text-gray-400", children: "\uCD1D \uC81C\uD488 \uC218" }), _jsx("h3", { className: "text-2xl font-semibold", children: totalProducts.toLocaleString() })] })] }) }), _jsx(Card, { className: "p-6", children: _jsxs("div", { className: "flex items-center space-x-4", children: [_jsx("div", { className: "p-3 bg-green-100 rounded-lg dark:bg-green-900", children: _jsx(BarChart3, { className: "w-6 h-6 text-green-600 dark:text-green-300" }) }), _jsxs("div", { children: [_jsx("p", { className: "text-sm font-medium text-gray-600 dark:text-gray-400", children: "\uCD1D \uC7AC\uACE0\uB7C9" }), _jsx("h3", { className: "text-2xl font-semibold", children: totalStock.toLocaleString() })] })] }) }), _jsx(Card, { className: "p-6", children: _jsxs("div", { className: "flex items-center space-x-4", children: [_jsx("div", { className: "p-3 bg-yellow-100 rounded-lg dark:bg-yellow-900", children: _jsx(AlertTriangle, { className: "w-6 h-6 text-yellow-600 dark:text-yellow-300" }) }), _jsxs("div", { children: [_jsx("p", { className: "text-sm font-medium text-gray-600 dark:text-gray-400", children: "\uC800\uC7AC\uACE0 \uC81C\uD488" }), _jsx("h3", { className: "text-2xl font-semibold", children: totalLowStock.toLocaleString() })] })] }) }), _jsx(Card, { className: "p-6", children: _jsxs("div", { className: "flex items-center space-x-4", children: [_jsx("div", { className: "p-3 bg-purple-100 rounded-lg dark:bg-purple-900", children: _jsx(TrendingUp, { className: "w-6 h-6 text-purple-600 dark:text-purple-300" }) }), _jsxs("div", { children: [_jsx("p", { className: "text-sm font-medium text-gray-600 dark:text-gray-400", children: "\uD3C9\uADE0 \uAC00\uACA9" }), _jsx("h3", { className: "text-2xl font-semibold", children: avgPrice.toLocaleString(undefined, {
                                                    style: 'currency',
                                                    currency: 'KRW'
                                                }) })] })] }) })] }), _jsxs("div", { className: "bg-white rounded-lg shadow mb-8", children: [_jsx("div", { className: "px-4 py-5 border-b border-gray-200 sm:px-6", children: _jsx("h3", { className: "text-lg font-medium text-gray-900", children: "\uC800\uC7AC\uACE0 \uC54C\uB9BC" }) }), _jsx("div", { className: "p-4", children: isLoading ? (_jsx("div", { className: "flex justify-center items-center h-32", children: _jsx("div", { className: "animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-kyobo" }) })) : lowStockProducts.length === 0 ? (_jsx("p", { className: "text-gray-500 text-center py-8", children: "\uC800\uC7AC\uACE0 \uC0C1\uD488\uC774 \uC5C6\uC2B5\uB2C8\uB2E4." })) : (_jsxs("div", { className: "overflow-x-auto", children: [_jsxs("table", { className: "min-w-full divide-y divide-gray-200", children: [_jsx("thead", { className: "bg-gray-50", children: _jsxs("tr", { children: [_jsx("th", { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: "\uC0C1\uD488\uBA85" }), _jsx("th", { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: "SKU" }), _jsx("th", { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: "\uC704\uCE58" }), _jsx("th", { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: "\uC7AC\uACE0/\uC548\uC804\uC7AC\uACE0" }), _jsx("th", { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: "\uC791\uC5C5" })] }) }), _jsx("tbody", { className: "bg-white divide-y divide-gray-200", children: lowStockProducts.slice(0, 5).map((product) => (_jsxs("tr", { className: "hover:bg-gray-50", children: [_jsx("td", { className: "px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900", children: product.name }), _jsx("td", { className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500", children: product.sku }), _jsx("td", { className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500", children: product.location }), _jsx("td", { className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500", children: _jsxs("span", { className: "inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800", children: [product.quantity, " / ", product.safetyStock] }) }), _jsx("td", { className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500", children: _jsx("button", { onClick: () => navigate(`/products/${product.id}/adjust`), className: "text-kyobo hover:text-kyobo-dark", children: "\uC785\uACE0 \uCC98\uB9AC" }) })] }, product.id))) })] }), lowStockProducts.length > 5 && (_jsx("div", { className: "px-6 py-3 text-center", children: _jsxs("button", { onClick: () => navigate('/products?lowStock=true'), className: "text-sm text-kyobo hover:text-kyobo-dark", children: ["\uBAA8\uB4E0 \uC800\uC7AC\uACE0 \uC0C1\uD488 \uBCF4\uAE30 (", lowStockProducts.length, ")"] }) }))] })) })] }), _jsxs("div", { className: "bg-white rounded-lg shadow", children: [_jsx("div", { className: "px-4 py-5 border-b border-gray-200 sm:px-6", children: _jsx("h3", { className: "text-lg font-medium text-gray-900", children: "\uCD5C\uADFC \uCD94\uAC00\uB41C \uC81C\uD488" }) }), _jsx("div", { className: "p-4", children: isLoading ? (_jsx("div", { className: "flex justify-center items-center h-32", children: _jsx("div", { className: "animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-kyobo" }) })) : recentProducts.length === 0 ? (_jsx("p", { className: "text-gray-500 text-center py-8", children: "\uCD5C\uADFC \uCD94\uAC00\uB41C \uC81C\uD488\uC774 \uC5C6\uC2B5\uB2C8\uB2E4." })) : (_jsxs("div", { className: "overflow-x-auto", children: [_jsxs("table", { className: "min-w-full divide-y divide-gray-200", children: [_jsx("thead", { className: "bg-gray-50", children: _jsxs("tr", { children: [_jsx("th", { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: "\uC0C1\uD488\uBA85" }), _jsx("th", { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: "SKU" }), _jsx("th", { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: "\uCE74\uD14C\uACE0\uB9AC" }), _jsx("th", { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: "\uC704\uCE58" }), _jsx("th", { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider", children: "\uC7AC\uACE0" })] }) }), _jsx("tbody", { className: "bg-white divide-y divide-gray-200", children: recentProducts.map((product) => (_jsxs("tr", { className: "hover:bg-gray-50", children: [_jsx("td", { className: "px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900", children: _jsx("a", { href: `/products/${product.id}`, className: "text-kyobo hover:underline", children: product.name }) }), _jsx("td", { className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500", children: product.sku }), _jsx("td", { className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500", children: product.category }), _jsx("td", { className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500", children: product.location }), _jsx("td", { className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500", children: product.quantity })] }, product.id))) })] }), _jsx("div", { className: "px-6 py-3 text-center", children: _jsx("button", { onClick: () => navigate('/products'), className: "text-sm text-kyobo hover:text-kyobo-dark", children: "\uBAA8\uB4E0 \uC81C\uD488 \uBCF4\uAE30" }) })] })) })] })] }) }));
};
export default DashboardPage;
